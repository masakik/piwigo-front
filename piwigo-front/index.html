<!DOCTYPE html>
<html ng-app="demo">
<head lang="en">
    <meta charset="UTF-8">
    <title>Imagens EESC</title>
</head>
<body ng-controller="DemoCtrl">
<h1>Escola de Engenharia de São Carlos</h1>

<div magicview class="magicview" data-items="items">
    <div class="item" ng-repeat="item in items | limitTo:quantity">
        <img ng-src="{{item.url}}" alt="">
    </div>
</div>
<script src="./lib/jquery-1.11.3.min.js"></script>
<script src="./lib/angular-1.4.x.min.js"></script>
<script src="./lib/angular-magicview/js/magicview.js"></script>

<script type="text/javascript">
    angular.module('ui.magicview')
            .value('rconfig', {
                maxHeight: 180,
                margin: '2px 3px 3px 2px'
            });

    var demo = angular.module('demo', ['ui.magicview']);

    demo.controller('DemoCtrl', ['$scope', '$http', '$interval', function ($scope, $http, $interval) {

        $scope.tag = 'public';
        $scope.get = 'http://imagens.eesc.usp.br/imagens/ws.php?format=json&method=pwg.images.search&query=tag=' + $scope.tag;
        // $scope.shuffle = true;
        $scope.size = 'small';
        $scope.quantity = 16;

        // -> Fisher–Yates shuffle algorithm
        $scope.shuffleArray = function (array) {
            var m = array.length, t, i;

            // While there remain elements to shuffle
            while (m) {
                // Pick a remaining element…
                i = Math.floor(Math.random() * m--);

                // And swap it with the current element.
                t = array[m];
                array[m] = array[i];
                array[i] = t;
            }
            return array;
        };

        $http.get($scope.get)
                .success(function (res) {
                    $scope.images = res.result.images;
                    $scope.items = [];
                    //console.log($scope.images);
                    for (i = 0; i < $scope.images.length; i++) {
                        $scope.items[i] = {};
                        $scope.items[i].url = $scope.images[i].derivatives.small.url;
                        $scope.items[i].width = $scope.images[i].derivatives.small.width;
                        $scope.items[i].height = $scope.images[i].derivatives.small.height;
                    }
                    $interval(function () {
                        $scope.items = $scope.shuffleArray($scope.items);
                    }, 5000);
                    //if ($scope.shuffle)
                    //$scope.items = $scope.shuffleArray($scope.items);
                });


    }])

</script>
</body>
</html>
